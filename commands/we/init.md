---
allowed-tools: [Read, Write, Edit, Bash, Glob, TodoWrite, Task, mcp__codeb-deploy__init_project, mcp__codeb-deploy__list_projects, mcp__codeb-deploy__port_summary, mcp__codeb-deploy__ensure_network, mcp__codeb-deploy__init_volume]
description: "신규 프로젝트 초기화 - 서버 DB/Redis 생성 + .env 파일 생성 + MCP 레지스트리 등록"
---

# /we:init - 프로젝트 초기화

## 목적
새 프로젝트를 위한 서버 인프라를 자동으로 설정합니다:
- PostgreSQL/Redis 컨테이너 생성 (Podman)
- .env.local 파일 생성 (로컬 개발용)
- 서버 환경 변수 파일 생성
- MCP 프로젝트 레지스트리 등록

## 중요 규칙
- **모든 응답은 한글로 작성**
- 비밀번호는 자동 생성 (24자리 랜덤)
- 포트 충돌 자동 방지
- 기존 프로젝트 중복 확인

## 사용법
```bash
/we:init [프로젝트명] [옵션]
```

## 주요 옵션

### 서비스 옵션
- `--database` - PostgreSQL 데이터베이스 포함 (기본값: true)
- `--redis` - Redis 캐시 포함 (기본값: false)
- `--no-database` - PostgreSQL 제외
- `--no-redis` - Redis 제외

### 프로젝트 옵션
- `-t, --type <type>` - 프로젝트 타입: nextjs, remix, nodejs, static (기본값: nextjs)
- `-i, --interactive` - 대화형 모드 (모든 옵션 질문)
- `--dry-run` - 미리보기 (실제 생성 안함)

### 포트 옵션
- `--staging-port <port>` - Staging 환경 포트 (자동 할당)
- `--production-port <port>` - Production 환경 포트 (자동 할당)

## 생성되는 리소스

### 서버 (141.164.60.51)
```
컨테이너:
├── {프로젝트}-postgres    # PostgreSQL 16 Alpine
└── {프로젝트}-redis       # Redis 7 Alpine

볼륨:
└── {프로젝트}-pgdata      # PostgreSQL 데이터

환경 파일:
├── /etc/containers/systemd/{프로젝트}.env
└── /etc/containers/systemd/{프로젝트}-staging.env

레지스트리:
└── /home/codeb/config/project-registry.json
```

### 로컬
```
.env.local                  # 로컬 개발용 환경 변수
```

## 예제

### 기본 초기화 (PostgreSQL만)
```bash
/we:init my-app
```

### PostgreSQL + Redis
```bash
/we:init my-app --database --redis
```

### 대화형 모드
```bash
/we:init -i
```

### 미리보기
```bash
/we:init my-app --database --redis --dry-run
```

### Remix 프로젝트
```bash
/we:init my-app --type remix --database
```

## 자동 생성되는 .env.local 예시
```env
# my-app Environment Variables
# Generated by we-cli init

# App Configuration
NODE_ENV=development
NEXT_PUBLIC_APP_NAME=my-app

# Database
DATABASE_URL=postgresql://my_app:randompass@141.164.60.51:5432/my_app
POSTGRES_HOST=141.164.60.51
POSTGRES_PORT=5432
POSTGRES_DB=my_app
POSTGRES_USER=my_app
POSTGRES_PASSWORD=randompass

# Redis
REDIS_URL=redis://:redispass@141.164.60.51:6379
REDIS_HOST=141.164.60.51
REDIS_PORT=6379
REDIS_PASSWORD=redispass

# Server
STAGING_PORT=3001
PRODUCTION_PORT=3000
```

## 프로젝트 초기화 후 다음 단계

1. **GitHub 저장소 생성**
   ```bash
   gh repo create my-app --private
   ```

2. **프레임워크 초기화**
   ```bash
   npx create-next-app@latest . --typescript
   # 또는
   npx create-remix@latest .
   ```

3. **개발 시작**
   - Claude Code와 함께 개발
   - .env.local이 자동으로 DB 연결 제공

4. **테스트 실행**
   ```bash
   /we:test
   ```

5. **CI/CD 설정**
   ```bash
   /we:workflow init my-app --database
   ```

6. **배포**
   ```bash
   git push origin main
   ```

## MCP 연동
- `mcp__codeb-deploy__init_project` - 프로젝트 설정 생성
- `mcp__codeb-deploy__list_projects` - 등록된 프로젝트 조회
- `mcp__codeb-deploy__port_summary` - 포트 할당 현황
- `mcp__codeb-deploy__ensure_network` - Podman 네트워크 확인
- `mcp__codeb-deploy__init_volume` - 볼륨 초기화

## 7-Agent 연동
이 명령어는 `project-initializer` 에이전트와 연동됩니다:
```bash
/we:agent project-initializer "my-app 프로젝트 초기화"
```

## 관련 명령어
- `/we:workflow` - CI/CD 워크플로우 생성
- `/we:deploy` - 프로젝트 배포
- `/we:registry` - MCP 레지스트리 관리
- `/we:secrets` - GitHub Secrets 설정
- `/we:ssh` - SSH 키 관리
- `/we:test` - E2E 테스트 실행

## 문제 해결

### SSH 연결 실패
```bash
/we:ssh setup
```

### 포트 충돌
```bash
# 포트 현황 확인
/we:registry ports

# 수동 포트 지정
/we:init my-app --staging-port 3010 --production-port 3009
```

### 기존 컨테이너 존재
```bash
# 서버에서 확인
ssh root@141.164.60.51 "podman ps -a | grep my-app"

# 제거 후 재시도
ssh root@141.164.60.51 "podman rm -f my-app-postgres my-app-redis"
```
